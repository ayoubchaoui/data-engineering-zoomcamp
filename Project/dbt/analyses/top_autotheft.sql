{{ config(schema='staging') }}
SELECT NEIGHBOURHOOD_158,
  COUNTIF(REPORT_YEAR = 2021) AS car_theft_2021,
  COUNTIF(REPORT_YEAR = 2022) AS car_theft_2022,
  FORMAT('%3.2f', (COUNTIF(REPORT_YEAR = 2022) - COUNTIF(REPORT_YEAR = 2021)) / COUNTIF(REPORT_YEAR = 2021)*100) AS pct_change_2021_to_2022
FROM
  {{ source('staging','crime_data')}}
WHERE
  MCI_CATEGORY = 'Auto Theft'
  AND REPORT_YEAR IN (2021,
    2022)
GROUP BY NEIGHBOURHOOD_158
ORDER BY
  (COUNTIF(REPORT_YEAR = 2022) - COUNTIF(REPORT_YEAR = 2021)) / COUNTIF(REPORT_YEAR = 2022) DESC